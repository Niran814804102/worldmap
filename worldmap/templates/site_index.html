{% extends 'index.html' %}
{% load i18n %}
{% comment %}
This is where you can override the hero area block. You can simply modify the content below or replace it wholesale to meet your own needs.
{% endcomment %}
  {% block hero %}
  <div id="indexTop">
    <div class="row">
        <div id="topleft" class="col-md-4">
          <div id="carousel-worldmap" class="carousel slide" data-ride="carousel">
            <!-- Wrapper for slides -->
            <div class="carousel-inner" role="listbox">
              <div class="item active">
                <img src="{{ STATIC_URL }}img/slide-china.jpg" alt="...">
                <div class="carousel-caption">
                  ChinaMap
                </div>
              </div>
              <div class="item">
                <img src="{{ STATIC_URL }}img/slide-africa.jpg" alt="...">
                <div class="carousel-caption">
                  AfricaMap
                </div>
              </div>
              <div class="item">
                <img src="{{ STATIC_URL }}img/slide-japan.jpg" alt="...">
                <div class="carousel-caption">
                  Japan's 2011 disasters
                </div>
              </div>
              <div class="item">
                <img src="{{ STATIC_URL }}img/slide-boston.jpg" alt="...">
                <div class="carousel-caption">
                  Boston Research Map
                </div>
              </div>
              <div class="item">
                <img src="{{ STATIC_URL }}img/slide-giza.jpg" alt="...">
                <div class="carousel-caption">
                  GizaMap
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="topRight" class="col-md-6">
            <div class="row">
                <div>
                    <div id="tmi01" class="topRightDiv">
                        <img class="picItem" src="{{ STATIC_URL }}img/map/noData.jpg" onerror="this.src='{{ STATIC_URL }}img/map/noData.jpg'"></img>
                        <p class="imgTitle"></p>
                    </div>
                    <div id="tmi02" class="topRightDiv">
                        <img class="picItem" src="{{ STATIC_URL }}img/map/noData.jpg" onerror="this.src='{{ STATIC_URL }}img/map/noData.jpg'"></img>
                        <p class="imgTitle"></p>
                    </div>
                    <div id="tmi03" class="topRightDiv">
                        <img class="picItem" src="{{ STATIC_URL }}img/map/noData.jpg" onerror="this.src='{{ STATIC_URL }}img/map/noData.jpg'"></img>
                        <p class="imgTitle"></p>
                    </div>
                </div>
                <div>
                    <div id="tmi04" class="topRightDiv">
                        <img class="picItem" src="{{ STATIC_URL }}img/map/noData.jpg" onerror="this.src='{{ STATIC_URL }}img/map/noData.jpg'"></img>
                        <p class="imgTitle"></p>
                    </div>
                    <div id="tmi05" class="topRightDiv">
                        <img class="picItem" src="{{ STATIC_URL }}img/map/noData.jpg" onerror="this.src='{{ STATIC_URL }}img/map/noData.jpg'"></img>
                        <p class="imgTitle"></p>
                    </div>
                    <div id="tmi06" class="topRightDiv">
                        <img class="picItem" src="{{ STATIC_URL }}img/map/noData.jpg" onerror="this.src='{{ STATIC_URL }}img/map/noData.jpg'"></img>
                        <p class="imgTitle"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
  </div>
    <div class="container col-md-offset-3">
        <a class="btn btn-primary" href="{% url "new_map" %}">{% trans "Create Map" %}</a>
        <a class="btn btn-primary" href="{% url "maps_browse" %}">{% trans "View Map" %}</a>
        <a class="btn btn-primary" href="{% url "layer_browse" %}">{% trans "My Layers" %}</a>
        <a class="btn btn-primary" href="{% url "layer_upload" %}">{% trans "Upload Layer" %}</a>
        <a class="btn btn-primary" href="{% url "layer_create" %}">{% trans "Create Layer" %}</a>
        <a class="btn btn-primary" href="{% url "about" %}">{% trans "About" %}</a>
    </div>
    <!-- IndexTop End -->
      <!--hottest map Start-->
    <div class="thematicMapList">
        <div class="subMapListTitle">&emsp;
            <br>Hottest Maps
            <select id="category1" class="selectpicker" data-style="btn-primary" onchange="selectOnChange1(this)"></select>
        </div>
        <div id="thematic1" class="subMapList custom-scrollbar">
            <div>
                <div id="tmi11" class="thematicDiv">
                    <img class="picItem" src="{{ STATIC_URL }}img/map/noData.jpg" onerror="this.src='{{ STATIC_URL }}img/map/noData.jpg'"></img>
                    <p class="imgTitle"></p>
                </div>
                <div id="tmi12" class="thematicDiv">
                    <img class="picItem" src="{{ STATIC_URL }}img/map/noData.jpg" onerror="this.src='{{ STATIC_URL }}img/map/noData.jpg'"></img>
                    <p class="imgTitle"></p>
                </div>
                <div id="tmi13" class="thematicDiv">
                    <img class="picItem" src="{{ STATIC_URL }}img/map/noData.jpg" onerror="this.src='{{ STATIC_URL }}img/map/noData.jpg'"></img>
                    <p class="imgTitle"></p>
                </div>
                <div id="tmi14" class="thematicDiv">
                    <img class="picItem" src="{{ STATIC_URL }}img/map/noData.jpg" onerror="this.src='{{ STATIC_URL }}img/map/noData.jpg'"></img>
                    <p class="imgTitle"></p>
                </div>
                <div id="tmi15" class="thematicDiv">
                    <img class="picItem" src="{{ STATIC_URL }}img/map/noData.jpg" onerror="this.src='{{ STATIC_URL }}img/map/noData.jpg'"></img>
                    <p class="imgTitle"></p>
                </div>
                <div id="tmi16" class="thematicDiv">
                    <img class="picItem" src="{{ STATIC_URL }}img/map/noData.jpg" onerror="this.src='{{ STATIC_URL }}img/map/noData.jpg'"></img>
                    <p class="imgTitle"></p>
                </div>
            </div>
        </div>
        <!--hottest map End-->
        <!--latest map Start-->
        <div class="subMapListTitle">
            <br>&emsp;Latest Maps
            <select id="category2" class="selectpicker" data-style="btn-primary" onchange="selectOnChange2(this)"></select>
        </div>
        <div id="thematic2" class="subMapList custom-scrollbar">
            <div>
                <div id="tmi21" class="thematicDiv">
                    <img class="picItem" src="{{ STATIC_URL }}img/map/noData.jpg" onerror="this.src='{{ STATIC_URL }}img/map/noData.jpg'"></img>
                    <p class="imgTitle"></p>
                </div>
                <div id="tmi22" class="thematicDiv">
                    <img class="picItem" src="{{ STATIC_URL }}img/map/noData.jpg" onerror="this.src='{{ STATIC_URL }}img/map/noData.jpg'"></img>
                    <p class="imgTitle"></p>
                </div>
                <div id="tmi23" class="thematicDiv">
                    <img class="picItem" src="{{ STATIC_URL }}img/map/noData.jpg" onerror="this.src='{{ STATIC_URL }}img/map/noData.jpg'"></img>
                    <p class="imgTitle"></p>
                </div>
                <div id="tmi24" class="thematicDiv">
                    <img class="picItem" src="{{ STATIC_URL }}img/map/noData.jpg" onerror="this.src='{{ STATIC_URL }}img/map/noData.jpg'"></img>
                    <p class="imgTitle"></p>
                </div>
                <div id="tmi25" class="thematicDiv">
                    <img class="picItem" src="{{ STATIC_URL }}img/map/noData.jpg" onerror="this.src='{{ STATIC_URL }}img/map/noData.jpg'"></img>
                    <p class="imgTitle"></p>
                </div>
                <div id="tmi26" class="thematicDiv">
                    <img class="picItem" src="{{ STATIC_URL }}img/map/noData.jpg" onerror="this.src='{{ STATIC_URL }}img/map/noData.jpg'"></img>
                    <p class="imgTitle"></p>
                </div>
            </div>
        </div>
    </div>
      <!--hotest map End-->
  {% endblock %}
  
  {% block mainbody %}
    <div class="container landing-footer">
      <div class="row">
        <div class="col-md-8">
          <p>{% trans "Build your own mapping portal and publish it to the world or to just a few collaborators. WorldMap is open source software." %}</p>

          <p>{% trans "WorldMap is being developed by the " %}<a href="http://gis.harvard.edu">{% trans "Center for Geographic Analysis" %}</a> {% trans "at" %} <a href="http://www.harvard.edu">Harvard University</a>.</p>
        </div>
        <div class="col-md-4">
          <p><a target="_blank" href="https://www.youtube.com/watch?v=Ajctx6h1t5s"><img src="http://img.youtube.com/vi/Ajctx6h1t5s/mqdefault.jpg" alt=""></a>
          <p><a target="_blank" href="https://www.youtube.com/watch?v=Ajctx6h1t5s">Watch the WorldMap Quick Start video</a></p>
        </div>
      </div>
    </div>
      <script>
            $(document).ready(function (e) {
                $.ajaxSetup({//set the csrf(Cross-site request forgery) when using ajax, especially the post
                    data: {csrfmiddlewaretoken: '{{ csrf_token }}' },
                });
                showCategorys();//load the dropdown menu of category
                showMaps("tmi0","admin",0);//load the maps created by admin
                showMaps("tmi1","hottest",0);//load the hottest maps of all the category
                showMaps("tmi2","latest",0);//load the latest maps of all the category
            });
            window.onload=function(){
                 setImgHeight();//set the height according to the width, the rate is 7:16[noData.jpg]
            }
            //be activated when browser's size is changed
            window.onresize=function(){
                 setImgHeight();//set the height according to the width, the rate is 7:16[noData.jpg]
            }
            //set the selectchange event of category selectpicker
            function selectOnChange1(obj){
                var value = obj.options[obj.selectedIndex].value;
                showMaps("tmi1","hottest",value);
            }
            function selectOnChange2(obj){
                var value = obj.options[obj.selectedIndex].value;
                showMaps("tmi2","latest", value);
            }
            function showCategorys(){
                var url = "/getCategory/";
                var data = null;
                var csrftoken = getCookie('csrftoken');
                $.ajax({
                    url: url,
                    async: false,
                    cache: false,
                    type: "POST",
                    success: function (res) {
                        data = $.parseJSON(res);
                    },
                    beforeSend: function(xhr, settings) {
                      xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    }
                });
                var selectHTML = "<option value=0>All the Category</option>";
                for(category in data){
                    var categoryid = parseInt(category);
                    var categorydescription = data[category][0];
                    selectHTML += "<option value="+categoryid+">"+categorydescription+"</option> "
                }
                $("#category1").html(selectHTML);
                $("#category2").html(selectHTML);
            }
            function showMaps(divIdPrefix, type, category){
                var result = null;
                var url = "/getMostMaps/";
                var csrftoken = getCookie('csrftoken');
                $.ajax({
                    url: url,
                    async: false,
                    type: "POST",
                    data: {
                        category: category,
                        type: type
                    },
                    success: function (res) {
                        result = $.parseJSON(res);
                    },
                    beforeSend: function(xhr, settings) {
                      xhr.setRequestHeader("X-CSRFToken", csrftoken);
                    }
                });
                for(var i = 0; i< 6; i++)
                {
                    var mapname, curdiv, imgurl, mapurl, img;
                    if(result[i] != null)
                    {
                        mapname = result[i][0];
                        curdiv = divIdPrefix + (i+1);
                        imgurl = result[i][1];
                        mapurl = result[i][2];
                        img = $("#"+curdiv).find("img");
                        $("#"+curdiv).attr("onclick","location='"+mapurl+"'");
                        $("#"+curdiv).children("p").text(mapname);
                        img.attr("src",imgurl);
                    }
                    else
                    {
                        curdiv = divIdPrefix + (i+1);
                        img = $("#"+curdiv).find("img");
                        if(typeof($("#"+curdiv).attr("onclick"))!="undefined")
                        {
                            $("#"+curdiv).removeAttr("onclick");
                            $("#"+curdiv).children("p").text("");
                            img.attr("src","{{ STATIC_URL }}img/map/noData.jpg");
                        }
                    }
                }
            }
            // get cookie value from cookies
            function getCookie(name) {
                var cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = jQuery.trim(cookies[i]);
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            function setImgHeight() {
                var imgs = $(".picItem");
                imgs.each(function (i) {
                    var img = $(this);
                    var width = img.width();
                    var height = width* 0.5625;
                    img.height(height);
                });
            }
      </script>
{#    <script type="text/javascript" src="{{ GEONODE_CLIENT_LOCATION }}externals/ext/adapter/ext/ext-base.js"></script>#}
{#    <script type="text/javascript" src="{{ GEONODE_CLIENT_LOCATION }}externals/ext/ext-all.js"></script>#}
{#    <script type="text/javascript" src="{{ GEONODE_CLIENT_LOCATION }}script/ux.js"></script>#}
{#    <script type="text/javascript" src="{{ GEONODE_CLIENT_LOCATION }}script/GeoNode.js"></script>#}
{#    <script type="text/javascript" src="{{ GEONODE_CLIENT_LOCATION }}script/OpenLayers.js"></script>#}
{#    <script type="text/javascript" src="{{ GEONODE_CLIENT_LOCATION }}script/GeoExt.js"></script>#}
{#    <script type="text/javascript" src="{{ GEONODE_CLIENT_LOCATION }}script/gxp.js"></script>#}
{#    <!--[if IE]><link rel="stylesheet" type="text/css" href="{{ GEONODE_CLIENT_LOCATION }}theme/app/ie.css"/><![endif]-->#}
{#    <script type="text/javascript" src="{{ GEONODE_CLIENT_LOCATION }}script/GeoExplorer.js"></script>#}
{##}
{#    <script>#}
{#    var app;#}
{#    var init = function() {#}
{#        {% autoescape off %}#}
{#        var config = Ext.apply({#}
{#            about: {#}
{#                "title": "GeoNode Demo Map",#}
{#                "abstract": "This is a demonstration of GeoNode, an application for assembling and publishing web based maps.  After adding layers to the map, use the 'Save Map' button above to contribute your map to the GeoNode community.",#}
{#                "contact": "For more information, contact <a href='http://opengeo.org'>OpenGeo</a>."#}
{#            },#}
{#            defaultSourceType: "gxp_wmscsource",#}
{#            sources: {#}
{#                "demo": {url: "http://demo.geonode.org/geoserver/wms/"},#}
{#                "un": {url: "http://preview.grid.unep.ch:8080/geoserver/ows/"}#}
{#            },#}
{#            map: {#}
{#                "projection": "EPSG:900913",#}
{#                "maxResolution": 156543.0339,#}
{#                "maxExtent": [#}
{#                    -20037508.34, -20037508.34,#}
{#                    20037508.34, 20037508.34#}
{#                ],#}
{#                "units": "m",#}
{#                "layers": [ {#}
{#                    "name": "geonode:CA",#}
{#                    "source": "demo",#}
{#                    "group": "background",#}
{#                    "fixed": true#}
{#                } ],#}
{#                "center": [-9431265.5574205, 1449637.0555531],#}
{#                "zoom": 5#}
{#            },#}
{#            proxy: "{{ PROXY_URL }}",#}
{#            rest: "{% url "maps_browse" %}",#}
{#            ajaxLoginUrl: "{% url "account_ajax_login" %}",#}
{#            homeUrl: "{% url "home" %}",#}
{#            localGeoServerBaseUrl: "{{ GEOSERVER_BASE_URL }}",#}
{#            localCSWBaseUrl: "{{ CATALOGUE_BASE_URL }}",#}
{#            hypermapRegistryUrl: "{{ HYPERMAP_REGISTRY_URL }}",#}
{#            mapProxyUrl: "{{ HYPERMAP_REGISTRY_URL }}",#}
{#            solrUrl: "{{ SOLR_URL }}",#}
{#            username: "{{ user.username }}",#}
{#            csrfToken: "{{ csrf_token }}",#}
{#            {% if user.is_authenticated %}#}
{#            db_datastore: true,#}
{#            {% endif %}#}
{#            authorizedRoles: "{{ user.is_authenticated|yesno:"ROLE_ADMINISTRATOR,ROLE_ANONYMOUS" }}"#}
{#        });#}
{##}
{#        app = new GeoExplorer(config, true);#}
{#        {% endautoescape %}#}
{##}
{#        var searchStore = new Ext.data.JsonStore({#}
{#            url: app.solrUrl,#}
{#            root: 'response.docs',#}
{#            idProperty: 'id',#}
{#            remoteSort: true,#}
{#            totalProperty: 'response.numFound',#}
{#            fields: [#}
{#                {name: 'id', type: 'string'},#}
{#                {name: 'uuid', type: 'string'},#}
{#                {name: 'name', type: 'string'},#}
{#                {name: 'title', type: 'string'},#}
{#                {name: 'abstract', type: 'string'},#}
{#                {name: 'min_x', type: 'string'},#}
{#                {name: 'min_y', type: 'string'},#}
{#                {name: 'max_x', type: 'string'},#}
{#                {name: 'max_y', type: 'string'},#}
{#                {name: 'layer_originator', type: 'string'},#}
{#                {name: 'is_public', type: 'string'},#}
{#                {name: 'url', type: 'string'},#}
{#                {name: 'service_type', type: 'string'},#}
{#                {name: 'bbox', type: 'string'},#}
{#                {name: 'location', type: 'string'},#}
{#                {name: 'layer_date', type: 'string'},#}
{#                {name: 'layer_datetype', type: 'string'},#}
{#                {name: 'srs', type: 'string'},#}
{#                // not used?#}
{#                {name: 'Availability', type: 'string'},#}
{#                {name: 'LayerUsername', type: 'string'}#}
{##}
{#            ]#}
{#        });#}
{##}
{#        GeoNode.queryTerms = {#}
{#            intx: "product(max(0,sub(min(180,max_x),max(-180,min_x))),max(0,sub(min(90,max_y),max(-90,min_y))))",#}
{#            sort: "score desc",#}
{#            //qf: "LayerTitleSynonyms^0.2 ThemeKeywordsSynonymsIso^0.1 ThemeKeywordsSynonymsLcsh^0.1 PlaceKeywordsSynonyms^0.1 Publisher^0.1 layer_originator^0.1 Abstract^0.2",#}
{#            fl: "id, uuid, name, title, abstract, min_x, min_y, max_x, max_y, layer_originator, is_public, url, service_type, bbox, location, layer_datetype, srs",#}
{#            qf: "title_txt^1 abstract_txt^0.2 originator_txt layer_username",#}
{#            wt: "json",#}
{#            defType: "edismax",#}
{#            q: "*",#}
{#            fq: [#}
{#                "{!frange l=0 incl=false cache=false}$intx"#}
{#            ]#}
{#        };#}
{##}
{#        loadLayerFromSearchStore(searchStore,"tmi1",'service_type:"Hypermap:WorldMap"');#}
{#        loadLayerFromSearchStore(searchStore,"tmi2",'service_type:"OGC:WMS"');#}
{#        //loadLayerFromSearchStore(searchStore,"tmi3","service_type:'ESRI:ArcGIS:ImageServer'");#}
{#        //loadLayerFromSearchStore(searchStore,"tmi4","service_type:'ESRI:ArcGIS:MapServer'");#}
{##}
{#    }#}
{##}
{#    $(document).ready(init);#}
{##}
{##}
{#    function setQueryItems(serviceType){#}
{#        // Clear the Key Words#}
{#        GeoNode.queryTerms.q = "*";#}
{#        // Remove any layer_originator filter if there#}
{#        for(var i=0;i<GeoNode.queryTerms.fq.length;i++){#}
{#            if(GeoNode.queryTerms.fq[i].indexOf('layer_originator') > -1){#}
{#                GeoNode.queryTerms.fq.splice(i, 1);#}
{#            }#}
{#        };#}
{#        // Remove any DataType filter if there#}
{#        for(var i=0;i<GeoNode.queryTerms.fq.length;i++){#}
{#            if(GeoNode.queryTerms.fq[i].indexOf('service_type') > -1){#}
{#                GeoNode.queryTerms.fq.splice(i, 1);#}
{#            }#}
{#        };#}
{#        // Add DataType filter#}
{#        var datatypes = serviceType;#}
{#        if(datatypes !== ''){#}
{#            GeoNode.queryTerms.fq.push(datatypes);#}
{#        };#}
{#        // Remove any date filter if there#}
{#        for(var i=0;i<GeoNode.queryTerms.fq.length;i++){#}
{#            if(GeoNode.queryTerms.fq[i].indexOf('layer_date') > -1){#}
{#                GeoNode.queryTerms.fq.splice(i, 1);#}
{#            }#}
{#        };#}
{#        // Set the query start#}
{#        GeoNode.queryTerms.start = 0;#}
{#    }#}
{#    function loadLayerFromSearchStore(searchStore,divIdPrefix,serviceType) {#}
{#        setQueryItems(serviceType);#}
{#        searchStore.load({params:GeoNode.queryTerms});#}
{#        var layer;#}
{#        var layerStore = searchStore.data.items;#}
{#        for(layer in layerStore){#}
{#            var layerName = layer["title"];#}
{#            var curdiv = divIdPrefix + (parseInt(layer["id"])+1);#}
{#            //$("#"+curdiv).attr("onclick","location='./main.action?mapid="+mapid+"'");#}
{#            $("#"+curdiv).children("p").text(layerName);#}
{#            //img.attr("src","./img/map/"+mapid+".jpg");#}
{#        }#}
{#    }#}
{#    </script>#}
  {% endblock %}
